{"ast":null,"code":"import _toConsumableArray from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import'./App.css';import HomePage from'./client/containers/HomePage';import DisplayCart from'./client/containers/DisplayCart';import DisplayDrawing from'./client/containers/DisplayDrawing';import drawings from'./drawings';import Login from'./client/containers/Login';import{Route,Switch,Redirect,withRouter}from'react-router-dom';import Signup from'./client/containers/Signup';import OrderHistory from'./client/components/OrderHistory';var DEFAULT_STATE={token:null,user_id:'',user:null,drawings:drawings,specs:null,cart:[],error:false};var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);function App(){var _getPrototypeOf2;var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(App)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state=DEFAULT_STATE;_this.specsMethod=function(drawing){_this.setState({specs:drawing});};_this.addToCart=function(drawing,material){_this.setState({cart:[].concat(_toConsumableArray(_this.state.cart),[drawing]),specs:null});};_this.resetSpecs=function(){_this.setState({specs:null});};_this.getToken=function(event){var username=event.target.username.value;var password=event.target.password.value;console.log(\"EVENT\",username,password);return fetch(\"/api/v1/login\",{method:\"POST\",headers:{\"Content-type\":\"application/json\",\"Accept\":\"application/json\"},body:JSON.stringify({username:username,password:password})}).then(function(r){return r.json();}).then(function(data){console.log(\"data\",data);if(data.errors){_this.setState({error:true});}else{localStorage.token=data.token;localStorage.user_id=data.user_id;_this.setState({token:data.token,user_id:data.user_id});}});};_this.totalAmount=function(cart){if(cart.length===0)return 0;var prices=cart.map(function(item){return item.price;});var total=prices.reduce(function(total,num){return total+num;});return total;};_this.getUser=function(){return fetch(\"/api/v1/users/\".concat(_this.state.user_id),{headers:{'Content-Type':'application/json','Accept':'application/json','Authorization':_this.state.token}}).then(function(res){return res.json();}).then(function(user){localStorage.setItem('user',JSON.stringify(user));_this.setState({user:user,drawings:drawings});});};_this.fetchUser=function(event){event.preventDefault();_this.getToken(event).then(function(){_this.getUser();});};_this.newUser=function(event){var username=event.target.username.value;var password=event.target.password.value;return fetch(\"/api/v1/users\",{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({first_name:event.target.first_name.value,last_name:event.target.last_name.value,username:username,password:password})}).then(function(r){return r.json();}).then(function(data){_this.setState({username:username,password:password});// console.log(data, \"data\")\n_this.fetchUser(event);});};_this.createUser=function(event){event.preventDefault();_this.newUser(event).then(_this.getToken()).then(function(){_this.getUser();});};_this.logOut=function(){localStorage.token=null;localStorage.user_id=null;localStorage.user=null;_this.setState(DEFAULT_STATE);};_this.removeFromCart=function(item){var newCart=_this.state.cart.filter(function(data){return data!==item;});_this.setState({cart:newCart});};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var user=JSON.parse(localStorage.getItem('user'));if(localStorage.token){this.setState({token:localStorage.token,user_id:localStorage.user_id,user:user});}}},{key:\"render\",value:function render(){var _this2=this;localStorage.setItem('cart',JSON.stringify(this.state.cart));return React.createElement(\"div\",{className:\"App\"},React.createElement(Switch,null,React.createElement(Route,{exact:true,path:\"/\",render:function render(props){return React.createElement(HomePage,{resetSpecs:_this2.resetSpecs,specs:_this2.state.specs,specsMethod:_this2.specsMethod,logOut:_this2.logOut,user:_this2.state.user,drawings:_this2.state.drawings,cart:_this2.state.cart,addToCart:_this2.addToCart});}}),React.createElement(Route,{path:\"/cart\",render:function render(props){return React.createElement(DisplayCart,{resetSpecs:_this2.resetSpecs,specs:_this2.state.specs,specsMethod:_this2.specsMethod,logOut:_this2.logOut,user:_this2.state.user,drawings:_this2.state.drawings,cart:_this2.state.cart,addToCart:_this2.addToCart,loginAttempt:_this2.loginAttempt,fetchUser:_this2.fetchUser,totalAmount:_this2.totalAmount,getUser:_this2.getUser,removeFromCart:_this2.removeFromCart,error:_this2.state.error});}}),React.createElement(Route,{path:\"/drawing\",render:function render(props){return React.createElement(DisplayDrawing,{resetSpecs:_this2.resetSpecs,specs:_this2.state.specs,specsMethod:_this2.specsMethod,logOut:_this2.logOut,user:_this2.state.user,drawings:_this2.state.drawings,cart:_this2.state.cart,addToCart:_this2.addToCart});}}),React.createElement(Route,{path:\"/signup\",render:function render(props){return React.createElement(Signup,{createUser:_this2.createUser});}}),React.createElement(Route,{path:\"/login\",render:function render(props){return React.createElement(Login,{loginAttempt:_this2.loginAttempt,fetchUser:_this2.fetchUser,error:_this2.state.error});}}),React.createElement(Route,{path:\"/orderhistory\",render:function render(props){return React.createElement(OrderHistory,{resetSpecs:_this2.resetSpecs,specs:_this2.state.specs,specsMethod:_this2.specsMethod,logOut:_this2.logOut,user:_this2.state.user,drawings:_this2.state.drawings,cart:_this2.state.cart,addToCart:_this2.addToCart});}}),\"} />\",React.createElement(Redirect,{to:\"\"})),this.state.user?React.createElement(Redirect,{to:\"\"}):null,this.state.specs?React.createElement(Redirect,{to:\"drawing\"}):React.createElement(Redirect,{to:\"\"}));}}]);return App;}(React.Component);export default withRouter(App);","map":{"version":3,"sources":["/Users/karina/Desktop/projects/jpdraws/client/src/App.js"],"names":["React","HomePage","DisplayCart","DisplayDrawing","drawings","Login","Route","Switch","Redirect","withRouter","Signup","OrderHistory","DEFAULT_STATE","token","user_id","user","specs","cart","error","App","state","specsMethod","drawing","setState","addToCart","material","resetSpecs","getToken","event","username","target","value","password","console","log","fetch","method","headers","body","JSON","stringify","then","r","json","data","errors","localStorage","totalAmount","length","prices","map","item","price","total","reduce","num","getUser","res","setItem","fetchUser","preventDefault","newUser","first_name","last_name","createUser","logOut","removeFromCart","newCart","filter","parse","getItem","props","loginAttempt","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport './App.css';\nimport HomePage from './client/containers/HomePage'\nimport DisplayCart from './client/containers/DisplayCart'\nimport DisplayDrawing from './client/containers/DisplayDrawing'\nimport drawings from './drawings'\nimport Login from './client/containers/Login'\nimport {Route, Switch, Redirect, withRouter} from 'react-router-dom'\nimport Signup from './client/containers/Signup'\nimport OrderHistory from './client/components/OrderHistory'\n\nconst DEFAULT_STATE = {\n  token: null,\n  user_id: '',\n  user: null,\n  drawings: drawings,\n  specs: null,\n  cart: [],\n  error: false\n}\n\nclass App extends React.Component {\n  state= DEFAULT_STATE\n\n  componentDidMount(){\n    let user = JSON.parse(localStorage.getItem('user'))\n    if (localStorage.token){\n      this.setState({\n        token: localStorage.token,\n        user_id: localStorage.user_id,\n        user\n      })\n    }\n  }\n\n  specsMethod = (drawing) => {\n    this.setState({\n      specs: drawing\n    })\n  }\n\n  addToCart = (drawing, material) => {\n    this.setState({\n      cart: [...this.state.cart, drawing],\n      specs: null\n    })\n  }\n\n  resetSpecs = () => {\n    this.setState({\n      specs: null\n    })\n  }\n\n  getToken = (event) => {\n    let username = event.target.username.value\n    let password = event.target.password.value\n    console.log(\"EVENT\", username, password)\n    return fetch(\"/api/v1/login\", {\n      method: \"POST\",\n      headers: {\n        \"Content-type\": \"application/json\",\n        \"Accept\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    })\n      .then(r => r.json())\n      .then(data => {\n        console.log(\"data\", data)\n        if (data.errors) {\n          this.setState({\n            error: true\n          })\n        } else {\n          localStorage.token = data.token\n          localStorage.user_id = data.user_id\n          this.setState({\n            token: data.token,\n            user_id: data.user_id\n          })\n        }\n      })\n  }\n\n  totalAmount = (cart) => {\n    if (cart.length === 0) return 0\n\n    let prices = cart.map((item) => {return item.price})\n    let total = prices.reduce((total, num) => {return total + num})\n    return total\n  }\n\n  getUser = () => {\n    return fetch(`/api/v1/users/${this.state.user_id}`, {\n    headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        'Authorization': this.state.token\n      }\n    })\n    .then(res => res.json())\n    .then(user => {\n      localStorage.setItem('user', JSON.stringify(user))\n      this.setState({\n        user,\n        drawings\n      })\n    })\n  }\n\n  fetchUser = (event) => {\n    event.preventDefault()\n    this.getToken(event)\n      .then(() => {\n        this.getUser()\n    })\n  }\n\n  newUser = (event) => {\n    let username = event.target.username.value\n    let password = event.target.password.value\n    return fetch(\"/api/v1/users\", {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify({\n        first_name: event.target.first_name.value,\n        last_name:event.target.last_name.value,\n        username,\n        password\n      })\n    })\n    .then(r => r.json())\n    .then(data => {\n      this.setState({\n        username,\n        password\n      })\n      // console.log(data, \"data\")\n      this.fetchUser(event)\n    })\n  }\n\n  createUser = (event) => {\n    event.preventDefault()\n    this.newUser(event)\n    .then(\n    this.getToken())\n      .then(() => {\n        this.getUser()\n    })\n  }\n\n  logOut = () => {\n    localStorage.token = null\n    localStorage.user_id = null\n    localStorage.user = null\n    this.setState(\n      DEFAULT_STATE\n    )\n  }\n\n  removeFromCart = (item) => {\n    let newCart = this.state.cart.filter(data => {\n      return data !== item\n    })\n    this.setState({\n      cart: newCart\n    })\n  }\n\n  render() {\n    localStorage.setItem('cart', JSON.stringify(this.state.cart))\n    return (\n        <div className=\"App\">\n          <Switch>\n            <Route exact path='/' render={(props) => <HomePage resetSpecs={this.resetSpecs} specs={this.state.specs} specsMethod={this.specsMethod} logOut={this.logOut} user={this.state.user} drawings={this.state.drawings} cart={this.state.cart} addToCart={this.addToCart}/>} />\n\n            <Route path='/cart' render={(props) => <DisplayCart resetSpecs={this.resetSpecs} specs={this.state.specs} specsMethod={this.specsMethod} logOut={this.logOut} user={this.state.user} drawings={this.state.drawings} cart={this.state.cart} addToCart={this.addToCart} loginAttempt={this.loginAttempt} fetchUser={this.fetchUser} totalAmount={this.totalAmount} getUser={this.getUser} removeFromCart={this.removeFromCart} error={this.state.error} />} />\n\n            <Route path='/drawing' render={(props) => <DisplayDrawing resetSpecs={this.resetSpecs} specs={this.state.specs} specsMethod={this.specsMethod} logOut={this.logOut} user={this.state.user} drawings={this.state.drawings} cart={this.state.cart} addToCart={this.addToCart} />} />\n\n            <Route path='/signup' render={(props) => <Signup createUser={ this.createUser }/>} />\n\n            <Route path='/login' render={(props) => <Login loginAttempt={this.loginAttempt} fetchUser={this.fetchUser}\n            error={this.state.error} />} />\n\n            <Route path='/orderhistory' render={(props) => <OrderHistory resetSpecs={this.resetSpecs} specs={this.state.specs} specsMethod={this.specsMethod} logOut={this.logOut} user={this.state.user} drawings={this.state.drawings} cart={this.state.cart} addToCart={this.addToCart}/>} />} />\n\n            <Redirect to='' />\n          </Switch>\n\n\n\n           {this.state.user ?\n           <Redirect to='' />\n            :\n            null\n            }\n\n          { this.state.specs ?\n            <Redirect to='drawing' />\n            :\n            <Redirect to='' />\n           }\n\n      </div>\n    )\n  }\n}\n\nexport default withRouter(App)\n"]},"metadata":{},"sourceType":"module"}