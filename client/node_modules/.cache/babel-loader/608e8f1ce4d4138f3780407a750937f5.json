{"ast":null,"code":"import _regeneratorRuntime from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{CardElement,injectStripe}from'react-stripe-elements';var CheckoutForm=/*#__PURE__*/function(_Component){_inherits(CheckoutForm,_Component);function CheckoutForm(props){var _this;_classCallCheck(this,CheckoutForm);_this=_possibleConstructorReturn(this,_getPrototypeOf(CheckoutForm).call(this,props));_this.handleChange=function(event){_this.setState(_defineProperty({},event.target.name,event.target.value));};_this.handleSubmit=function _callee(event){var _ref,token,amount,response;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_context.prev=1;_context.next=4;return _regeneratorRuntime.awrap(_this.props.stripe.createToken({name:_this.state.name}));case 4:_ref=_context.sent;token=_ref.token;amount=_this.state.amount;_context.next=9;return _regeneratorRuntime.awrap(fetch('/charge',{method:'POST',headers:{\"Content-Type\":\"text/plain\"},body:token.id+\"&\"+amount}));case 9:response=_context.sent;if(response.ok){_this.setState({complete:true});_this.props.cart.forEach(function(item){var user_id=_this.props.user.id;var drawing_id=item.id;fetch('/api/v1/transactions',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({user_id:user_id,drawing_id:drawing_id})}).then(function(res){return res.json();}).then(function(data){_this.props.getUser();});});};// redirect, clear inputs, thank alert\n_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);throw _context.t0;case 17:case\"end\":return _context.stop();}}},null,null,[[1,14]]);};_this.state={complete:false,name:\"\",amount:_this.props.totalAmount(_this.props.cart)};return _this;}_createClass(CheckoutForm,[{key:\"render\",value:function render(){if(this.state.complete)return React.createElement(\"h1\",null,\"Purchase Complete\");return React.createElement(\"main\",null,React.createElement(\"form\",{onSubmit:this.handleSubmit},React.createElement(\"input\",{type:\"text\",value:this.state.name,name:\"name\",placeholder:\"Full Name\",onChange:this.handleChange}),React.createElement(CardElement,{className:\"cardElement\"}),React.createElement(\"input\",{type:\"submit\",value:\"Purchase\",className:\"btn-item\"})));}}]);return CheckoutForm;}(Component);export default injectStripe(CheckoutForm);","map":{"version":3,"sources":["/Users/karina/Desktop/projects/jpdraws/client/src/client/components/CheckoutForm.js"],"names":["React","Component","CardElement","injectStripe","CheckoutForm","props","handleChange","event","setState","target","name","value","handleSubmit","preventDefault","stripe","createToken","state","token","amount","fetch","method","headers","body","id","response","ok","complete","cart","forEach","item","user_id","user","drawing_id","JSON","stringify","then","res","json","data","getUser","totalAmount"],"mappings":"moCAAA,MAAOA,CAAAA,KAAP,EAAeC,SAAf,KAA+B,OAA/B,CACA,OAAQC,WAAR,CAAqBC,YAArB,KAAwC,uBAAxC,C,GAEMC,CAAAA,Y,sEACJ,sBAAYC,KAAZ,CAAmB,8CACjB,8EAAMA,KAAN,GADiB,MASnBC,YATmB,CASJ,SAACC,KAAD,CAAW,CACxB,MAAKC,QAAL,oBACGD,KAAK,CAACE,MAAN,CAAaC,IADhB,CACuBH,KAAK,CAACE,MAAN,CAAaE,KADpC,GAGD,CAbkB,OAenBC,YAfmB,CAeJ,iBAAOL,KAAP,kJACbA,KAAK,CAACM,cAAN,GADa,iEAGW,MAAKR,KAAL,CAAWS,MAAX,CAAkBC,WAAlB,CAA8B,CAAEL,IAAI,CAAE,MAAKM,KAAL,CAAWN,IAAnB,CAA9B,CAHX,4BAGLO,KAHK,MAGLA,KAHK,CAIPC,MAJO,CAIE,MAAKF,KAAL,CAAWE,MAJb,kDAKUC,KAAK,CAAC,SAAD,CAAY,CACpCC,MAAM,CAAE,MAD4B,CAEpCC,OAAO,CAAE,CACP,eAAgB,YADT,CAF2B,CAKpCC,IAAI,CAAEL,KAAK,CAACM,EAAN,CAAW,GAAX,CAAiBL,MALa,CAAZ,CALf,SAKPM,QALO,eAYX,GAAIA,QAAQ,CAACC,EAAb,CAAiB,CACf,MAAKjB,QAAL,CAAc,CAACkB,QAAQ,CAAE,IAAX,CAAd,EACA,MAAKrB,KAAL,CAAWsB,IAAX,CAAgBC,OAAhB,CAAwB,SAACC,IAAD,CAAU,CAChC,GAAIC,CAAAA,OAAO,CAAG,MAAKzB,KAAL,CAAW0B,IAAX,CAAgBR,EAA9B,CACA,GAAIS,CAAAA,UAAU,CAAGH,IAAI,CAACN,EAAtB,CACAJ,KAAK,CAAC,sBAAD,CAAyB,CAC5BC,MAAM,CAAE,MADoB,CAE5BC,OAAO,CAAE,CACP,eAAgB,kBADT,CAEP,SAAU,kBAFH,CAFmB,CAM5BC,IAAI,CAAEW,IAAI,CAACC,SAAL,CAAe,CACnBJ,OAAO,CAAPA,OADmB,CAEnBE,UAAU,CAAVA,UAFmB,CAAf,CANsB,CAAzB,CAAL,CAWCG,IAXD,CAWM,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EAXT,EAYCF,IAZD,CAYM,SAAAG,IAAI,CAAI,CACZ,MAAKjC,KAAL,CAAWkC,OAAX,GACD,CAdD,EAeD,CAlBD,EAmBD,EACD;AAlCW,qKAfI,CAEjB,MAAKvB,KAAL,CAAa,CACXU,QAAQ,CAAE,KADC,CAEXhB,IAAI,CAAE,EAFK,CAGXQ,MAAM,CAAE,MAAKb,KAAL,CAAWmC,WAAX,CAAuB,MAAKnC,KAAL,CAAWsB,IAAlC,CAHG,CAAb,CAFiB,aAOlB,C,gEAgDO,CACN,GAAI,KAAKX,KAAL,CAAWU,QAAf,CAAyB,MAAO,mDAAP,CACzB,MACE,iCACE,4BAAM,QAAQ,CAAG,KAAKd,YAAtB,EACE,6BACE,IAAI,CAAC,MADP,CAEE,KAAK,CAAG,KAAKI,KAAL,CAAWN,IAFrB,CAGE,IAAI,CAAC,MAHP,CAIE,WAAW,CAAC,WAJd,CAKE,QAAQ,CAAG,KAAKJ,YALlB,EADF,CAQA,oBAAC,WAAD,EAAa,SAAS,CAAC,aAAvB,EARA,CASE,6BAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAC,UAA3B,CAAsC,SAAS,CAAC,UAAhD,EATF,CADF,CADF,CAgBD,C,0BA1EwBL,S,EA6E3B,cAAeE,CAAAA,YAAY,CAACC,YAAD,CAA3B","sourcesContent":["import React, {Component} from 'react';\nimport {CardElement, injectStripe} from 'react-stripe-elements';\n\nclass CheckoutForm extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      complete: false,\n      name: \"\",\n      amount: this.props.totalAmount(this.props.cart)\n    }\n  }\n\n  handleChange = (event) => {\n    this.setState({\n      [event.target.name]: event.target.value\n    })\n  }\n\n  handleSubmit = async (event) => {\n    event.preventDefault()\n    try {\n      let { token } = await this.props.stripe.createToken({ name: this.state.name })\n      let amount = this.state.amount\n      let response = await fetch('/charge', {\n        method: 'POST',\n        headers: {\n          \"Content-Type\": \"text/plain\"\n        },\n        body: token.id + \"&\" + amount\n      })\n      if (response.ok) {\n        this.setState({complete: true})\n        this.props.cart.forEach((item) => {\n          let user_id = this.props.user.id\n          let drawing_id = item.id\n          fetch('/api/v1/transactions', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n              user_id,\n              drawing_id\n            })\n          })\n          .then(res => res.json())\n          .then(data => {\n            this.props.getUser()\n          })\n        })\n      };\n      // redirect, clear inputs, thank alert\n    } catch (event) {\n      throw event\n    }\n  }\n\n  render(){\n    if (this.state.complete) return <h1>Purchase Complete</h1>;\n    return (\n      <main>\n        <form onSubmit={ this.handleSubmit }>\n          <input\n            type=\"text\"\n            value={ this.state.name }\n            name=\"name\"\n            placeholder=\"Full Name\"\n            onChange={ this.handleChange }\n          />\n        <CardElement className=\"cardElement\" />\n          <input type=\"submit\" value=\"Purchase\" className=\"btn-item\"/>\n        </form>\n      </main>\n\n    )\n  }\n}\n\nexport default injectStripe(CheckoutForm);\n"]},"metadata":{},"sourceType":"module"}